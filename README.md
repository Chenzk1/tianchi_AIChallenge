# Tianchi_AI

(https://tianchi.aliyun.com/competition/entrance/231708/introduction?spm=5176.12281957.1004.5.38b04c2aHy5QgS)

## 描述

给了杭州地铁81个站台1.1~1.25的数据，A榜给了28号数据预测29号出入人数；B榜给了26号数据，预测27号数据

## 目录

- code：自己的尝试
- 鱼佬baseline：(https://zhuanlan.zhihu.com/p/59998657)
- solution_A_22: A榜22
- solution_B_52: B榜52
- solution_A_58: (https://mp.weixin.qq.com/s/hzc6u1WYu8ztaRa4m371tw)
- solution_B_59: (https://zhuanlan.zhihu.com/p/61145712)

## A_22

- 剔除了1.1和周末数据
- 特征：1~3天的shift
- 模型：xgboost
- 重点：训练集验证集的划分：时间序列的交叉验证
  - 分别取23 24 25作验证集，24 25 28作测试集，对得到的误差作平均
  - 预测29时，将包括28的所有训练数据加入

！切忌只用28做验证

## B_52

> * 基于历史10分钟为单位的刷卡总人数进行建模，通过对当前时间单位的出入流量(label)对应前一天的时间、出入站流量、交叉特征，以及当前时间点之前所有历史数据的统计特征构建模型；线上成绩为：12.2821
> * 对应代码：./feature/generate_data.py、model_lgb.py
> * 基于历史10分钟为单位的刷卡类型(四种)人数进行建模，同理通过提取特征和对应标签构建模型，最后计算四种刷卡总人数和即为当前时间单位的流量；线上成绩为：12.5173
> * 对应代码：./feature/generate_data1.py、model_lgb1.py

* 即第一个模型与baseline相同，而第二个模型在进行特征构造时，在id中加入了PayType的特征
## A_58

- EDA
- 只用了近一周数据21~25 28 29
  - 观察发现同工作日的分布很类似
  - 21和28的inNums对比，发现有所减少；outNums有个时间点有所增加，其他时间减少，猜测是放假回家导致人流减少
- 基于相邻两天的分布是强相关的特征，用前一天的预测后一天的；基于相邻一周中周一的分布观测情况，假设我们数据的分布存在周期分布,所以直接用上一周周二(22日)的信息预测29日的结果
- 方案：
  - 计算上周21~25每10分钟的均值，计算上周每小时的均值——以小时为单位，更加稳定；计算每10分钟占小时的比例
  - 对于早上六点以前的出入流量，因为大多数为0,1,2，所以如果某一天这个数值较大，则分类时影像比较大，所以对其平滑，大于2的赋值2
  - 计算28日小时均值
  - 用28预测29，其中加入了上一周的分布规律：28小时均值*上周10min的均值/上周小时均值 * 0.95，0.95考虑到了人流量的减少

## B_59

- 三模型融合
- label的数值较大，且呈长尾 多峰分布-->归一化；将week作为分类特征，onehot
- LSTM：效果差
- 三次平滑：线上约14
- lgb：
  - 鱼佬baseline
  - 统计所有数据集的userID，剔除payType=3的客人后，设定阈值为50用以区分是否常客，并得到常客的ID列表-->统计每个时间段的出入常客个数
  - 滑窗三天
  - 28验证
  - 重要的特征还是直接跟inNums outNums相关的那几个



